<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FigmaJumpBack</title>
  <style>
    html, body {
      margin: 0; padding: 8px;
      box-sizing: border-box;
      overflow-x: hidden;
      font-family: sans-serif;
      height: 100%;
    }
    *, *::before, *::after { box-sizing: inherit; }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .title {
      margin: 0;
      font-size: 16px;
      color: rgba(0, 0, 0, 0.5);
    }
    #clearBtn {
      all: unset;
      cursor: pointer;
      font-size: 16px;
      padding: 4px;
    }
    #clearBtn:hover {
      background: #f0f0f0;
      border-radius: 4px;
    }

    #historyList {
      list-style: none;
      padding: 0;
      margin: 0;
      overflow-y: auto;
      overflow-x: hidden;
      max-height: calc(100% - 40px);
    }
    li { margin-bottom: 4px; }

    button.entry {
      all: unset;
      display: flex;
      align-items: flex-start;
      width: 274px;
      padding: 4px 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      overflow: hidden;
    }
    button.entry:hover {
      background: #f0f0f0;
    }

    .entry-icon {
      flex: 0 0 20px;
      margin-right: 6px;
    }
    .entry-content {
      flex: 1;
      overflow: hidden;
    }
    .entry-page {
      font-size: 12px;
      font-weight: bold;
      margin: 0 0 2px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .entry-frame {
      font-size: 14px;
      margin: 0;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="header">
    <h2 class="title">Recent</h2>
    <button id="clearBtn">ðŸ§¹</button>
  </div>
  <ul id="historyList">
    <li><i>Loadingâ€¦</i></li>
  </ul>

  <script>
    const CDN = "https://owlson.github.io/FigmaJumpBack/assets/icons";
    const ICON_URLS = {
      COMPONENT: `${CDN}/component.svg`,
      INSTANCE:  `${CDN}/instance.svg`,
      GROUP:     `${CDN}/group.svg`,
      FRAME:     `${CDN}/frame.svg`,
      SECTION:   `${CDN}/section.svg`,
      PAGE:      `${CDN}/page.svg`,
      IMAGE:     `${CDN}/image.svg`,
      VECTOR:    `${CDN}/vector.svg`,
      TEXT:      `${CDN}/text.svg`,
      DEFAULT:   `${CDN}/default.svg`
    };

    function getIconImg(type) {
      const url = ICON_URLS[type] || ICON_URLS.DEFAULT;
      return `<img class="entry-icon" src="${url}" width="20" height="20" alt="${type}">`;
    }

    function navigate(i) {
      parent.postMessage({ pluginMessage: { type: 'navigateTo', index: i } }, '*');
    }

    window.onload = () => {
      parent.postMessage({ pluginMessage: { type: 'getHistory' } }, '*');
      window.onmessage = e => {
        const msg = e.data.pluginMessage;
        if (msg.type === 'history') {
          const list = document.getElementById('historyList');
          list.innerHTML = '';
          if (!msg.history.length) {
            list.innerHTML = '<li><i>History is empty.</i></li>';
            return;
          }
          msg.history.forEach((entry, idx) => {
            const li = document.createElement('li');
            const btn = document.createElement('button');
            btn.className = 'entry';
            btn.innerHTML =
              getIconImg(entry.nodeType) +
              `<div class="entry-content">
                 <p class="entry-page">${entry.pageName}</p>
                 <p class="entry-frame">${entry.nodeName || ''}</p>
               </div>`;
            btn.onclick = () => navigate(idx);
            li.appendChild(btn);
            list.appendChild(li);
          });
        }
      };
      document.getElementById('clearBtn').onclick = () =>
        parent.postMessage({ pluginMessage: { type: 'clearHistory' } }, '*');
    };
  </script>
</body>
</html>
